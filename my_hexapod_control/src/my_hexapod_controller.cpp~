#include <ros/ros.h>
#include "gait.h"
#include "ik.h"
#include "control.h"

int main (int argc, char **argv)
{
  ros::init( argc, argv, "my_hexapod_controller" );
  Control control;
  Gait gait;
  IK ik;

  ros::AsyncSpinner spinner( 2); // Using 2 threads
  spinner.start();
  ros::Rate loop_rate( control.MASTER_LOOP_RATE );
   int setup=1;
   //初始化机器人位姿
  while( ros::ok() )
  {
    control.partitionCmd_vel( &control.cmd_vel_ );
    if( setup )
    {
      ROS_INFO( "hexapod standing up." );
      setup=0;
      gait.gaitCycle( control.cmd_vel_, &control.feet_, &control.gait_vel_ );
      ik.calculateIK( control.feet_, control.body_, &control.legs_ );
      control.publishJointStates( control.legs_, control.feet_, gait.cycle_period_, gait.cycle_leg_number_);
    }
    gait.gaitCycle( control.cmd_vel_, &control.feet_, &control.gait_vel_ ); //周期步态
    ik.calculateIK( control.feet_, control.body_, &control.legs_ ); //逆运动学求解关节角度
    control.publishJointStates( control.legs_, control.feet_, gait.cycle_period_, gait.cycle_leg_number_); //发布关节角度话题
    
    loop_rate.sleep(); 
  }
  
   return 0;
  
}
